<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syndicate - Smart Budgeting Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Glossymorphic UI Styles */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-button {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
        }
        
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(59, 130, 246, 0.5);
            outline: none;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .dark {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .hover-icon {
            transition: all 0.3s ease;
        }
        
        .hover-icon:hover {
            transform: scale(1.2);
            color: #3b82f6;
        }
        
        .modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .animate-pulse-slow {
            animation: pulse 2s infinite;
        }
        select.glass-input option {
            background-color: #466374; /* Dark gray (or any other background you want) */
            backdrop-filter: blur(10px); /* Optional: adds a blur effect */
            color: white; /* Text color of the options */
        }
    </style>
</head>
<body class="font-sans text-white transition-colors duration-300">
    
    <!-- Navigation Bar -->
    <nav id="navbar" class="glass-card mx-4 mt-4 p-4 flex justify-between items-center hidden">
        <div class="flex items-center space-x-3">
            <i class="fas fa-chart-line text-2xl text-blue-400"></i>
            <h1 class="text-xl font-bold">Syndicate</h1>
        </div>
        <div class="flex items-center space-x-4">
            <span id="logged-username" class="text-sm"></span>
            <button id="theme-toggle" class="glass-button p-2 rounded-lg">
                <i class="fas fa-moon"></i>
            </button>
            <button id="logout-btn" class="glass-button px-4 py-2 rounded-lg hover:bg-red-500/20">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </button>
        </div>
    </nav>

    <!-- Landing Page -->
    <div id="landing-page" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-card p-12 text-center max-w-md w-full">
            <div class="mb-8">
                <i class="fas fa-chart-line text-6xl text-blue-400 mb-4"></i>
                <h1 class="text-4xl font-bold mb-2">Syndicate</h1>
                <p class="text-lg opacity-80">Smart Budgeting Platform</p>
            </div>
            <div class="space-y-4">
                <button id="login-btn" class="glass-button w-full py-3 rounded-lg font-semibold">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
                <button id="create-account-btn" class="glass-button w-full py-3 rounded-lg font-semibold">
                    <i class="fas fa-user-plus mr-2"></i>Create Account
                </button>
            </div>
        </div>
    </div>

    <!-- Create Account Page -->
    <div id="create-account-page" class="min-h-screen flex items-center justify-center p-4 hidden">
        <div class="glass-card p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold mb-6 text-center">Create Account</h2>
            <form id="create-account-form" class="space-y-4">
                <input type="text" id="ca-name" placeholder="Full Name" class="glass-input w-full p-3 text-white placeholder-gray-300" required>
                <input type="tel" id="ca-mobile" placeholder="Mobile Number" class="glass-input w-full p-3 text-white placeholder-gray-300" required>
                <input type="text" id="ca-username" placeholder="Username" class="glass-input w-full p-3 text-white placeholder-gray-300" required>
                <input type="password" id="ca-password" placeholder="Password" class="glass-input w-full p-3 text-white placeholder-gray-300" required>
                <input type="password" id="ca-confirm-password" placeholder="Confirm Password" class="glass-input w-full p-3 text-white placeholder-gray-300" required>
                <button type="submit" class="glass-button w-full py-3 rounded-lg font-semibold">
                    <i class="fas fa-user-plus mr-2"></i>Create Account
                </button>
                <button type="button" id="back-to-landing" class="glass-button w-full py-2 rounded-lg">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
            </form>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="min-h-screen flex items-center justify-center p-4 hidden">
        <div class="glass-card p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>
            <form id="login-form" class="space-y-4">
                <input type="text" id="login-username" placeholder="Username" class="glass-input w-full p-3 text-white placeholder-gray-300" required>
                <input type="password" id="login-password" placeholder="Password" class="glass-input w-full p-3 text-white placeholder-gray-300" required>
                <button type="submit" class="glass-button w-full py-3 rounded-lg font-semibold">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
                <div class="text-center">
                    <button type="button" id="forgot-password" class="text-blue-300 hover:text-blue-200 text-sm">
                        Forgot Password?
                    </button>
                </div>
                <button type="button" id="back-to-landing-login" class="glass-button w-full py-2 rounded-lg">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="p-4 pt-24 hidden">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl font-bold mb-8 text-center">Dashboard</h2>
            
            <!-- Dashboard Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass-card p-6 cursor-pointer hover:scale-105 transition-transform" data-dashboard="income">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-money-bill-wave text-3xl text-green-400 hover-icon"></i>
                        <span id="income-total" class="text-2xl font-bold">₹0</span>
                    </div>
                    <h3 class="text-lg font-semibold">Income</h3>
                </div>
                
                <div class="glass-card p-6 cursor-pointer hover:scale-105 transition-transform" data-dashboard="loans">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-university text-3xl text-red-400 hover-icon"></i>
                        <span id="loans-total" class="text-2xl font-bold">₹0</span>
                    </div>
                    <h3 class="text-lg font-semibold">Loan & Debts</h3>
                </div>
                
                <div class="glass-card p-6 cursor-pointer hover:scale-105 transition-transform" data-dashboard="expenses">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-shopping-cart text-3xl text-orange-400 hover-icon"></i>
                        <span id="expenses-total" class="text-2xl font-bold">₹0</span>
                    </div>
                    <h3 class="text-lg font-semibold">Daily Expenses</h3>
                </div>
                
                <div class="glass-card p-6 cursor-pointer hover:scale-105 transition-transform" data-dashboard="suspense">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-hand-holding-usd text-3xl text-purple-400 hover-icon"></i>
                        <span id="suspense-total" class="text-2xl font-bold">₹0</span>
                    </div>
                    <h3 class="text-lg font-semibold">Suspense Cash</h3>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glass-card p-6">
                    <h3 class="text-xl font-semibold mb-4">Income Distribution</h3>
                    <div class="chart-container">
                        <canvas id="income-chart"></canvas>
                    </div>
                </div>
                
                <div class="glass-card p-6">
                    <h3 class="text-xl font-semibold mb-4">Expense Breakdown</h3>
                    <div class="chart-container">
                        <canvas id="expense-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Income Dashboard -->
    <div id="income-dashboard" class="p-4 pt-24 hidden">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">Income Dashboard</h2>
                <button class="glass-button px-4 py-2 rounded-lg" id="back-to-dashboard">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                </button>
            </div>
            
            <!-- Add Income Form -->
            <div class="glass-card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">Add New Income</h3>
                <form id="income-form" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <select id="income-type" class="glass-input p-3 text-white" required>
                        <option value="">Select Type</option>
                        <option value="Salary">Salary</option>
                        <option value="Freelance">Freelance</option>
                        <option value="Rental">Rental</option>
                        <option value="Business">Business</option>
                        <option value="Trade">Trade</option>
                        <option value="Agriculture">Agriculture</option>
                        <option value="Export">Export</option>
                        <option value="Others">Others</option>
                    </select>
                    <input type="number" id="income-amount" placeholder="Amount" class="glass-input p-3 text-white placeholder-gray-300" required>
                    <input type="date" id="income-date" class="glass-input p-3 text-white" required>
                    <input type="text" id="income-description" placeholder="Description" class="glass-input p-3 text-white placeholder-gray-300 md:col-span-2">
                    <input type="hidden" id="editing-income-id">
                    <button type="submit" class="glass-button px-6 py-3 rounded-lg font-semibold">
                        <i class="fas fa-plus mr-2"></i>Add Income
                    </button>
                </form>
            </div>
            
            <!-- Income Table -->
            <div class="glass-card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Income Records</h3>
                    <div class="flex space-x-2">
                        <select id="income-filter-type" class="glass-input p-2 text-white text-sm">
                            <option value="">All Types</option>
                        </select>
                        <input type="date" id="income-filter-start-date" class="glass-input p-2 text-white text-sm" placeholder="Start Date">
                        <input type="date" id="income-filter-end-date" class="glass-input p-2 text-white text-sm" placeholder="End Date">
                        <button onclick="filterIncomeTable()" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-500">Filter</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left p-3">Type</th>
                                <th class="text-left p-3">Amount</th>
                                <th class="text-left p-3">Date</th>
                                <th class="text-left p-3">Description</th>
                                <th class="text-left p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="income-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Loans Dashboard -->
    <div id="loans-dashboard" class="p-4 pt-24 hidden">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">Loan & Debts Dashboard</h2>
                <button class="back-to-dashboard glass-button px-4 py-2 rounded-lg">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                </button>
            </div>
            
            <!-- Add Loan Form -->
            <div class="glass-card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">Add New Entry</h3>
                <form id="loan-form">
                    <div class="mb-4">
                        <select id="loan-type" class="glass-input p-3 text-white w-full" required>
                            <option value="">Select Type</option>
                            <option value="bank-loan">Bank Loan / Loan Using Gold</option>
                            <option value="land-loan">Loan Using Land / Land Docs</option>
                            <option value="debt">Debt</option>
                        </select>
                    </div>
                    
                    <div id="loan-fields" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Dynamic fields based on loan type -->
                    </div>
                    
                    <button type="submit" class="glass-button px-6 py-3 rounded-lg font-semibold mt-4">
                        <i class="fas fa-plus mr-2"></i>Add Entry
                    </button>
                </form>
            </div>
            
            <!-- Loans Table -->
            <div class="glass-card p-6">
                <h3 class="text-xl font-semibold mb-4">Loan & Debt Records</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left p-3">Type</th>
                                <th class="text-left p-3">Details</th>
                                <th class="text-left p-3">Amount</th>
                                <th class="text-left p-3">Interest</th>
                                <th class="text-left p-3">Current Total</th>
                                <th class="text-left p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="loans-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Expenses Dashboard -->
    <div id="expenses-dashboard" class="p-4 pt-24 hidden">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">Daily Expenses Dashboard</h2>
                <button class="back-to-dashboard glass-button px-4 py-2 rounded-lg">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                </button>
            </div>

            <!-- Add Expense Form -->
            <div class="glass-card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">Add New Expense</h3>
                <form id="expense-form" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <select id="expense-type" class="glass-input p-3 text-white" required>
                        <option value="">Select Type</option>
                        <option value="Petrol">Petrol</option>
                        <option value="Transport">Transport</option>
                        <option value="Food">Food</option>
                        <option value="Misc">Misc</option>
                        <option value="Others">Others</option>
                    </select>
                    <input type="text" id="expense-custom-type" placeholder="Custom Type" class="glass-input p-3 text-white placeholder-gray-300 hidden">
                    <input type="number" id="expense-amount" placeholder="Amount" class="glass-input p-3 text-white placeholder-gray-300" required>
                    <input type="date" id="expense-date" class="glass-input p-3 text-white" required>

                    <!-- Hidden field for editing -->
                    <input type="hidden" id="editing-expense-id">

                    <button type="submit" class="glass-button px-6 py-3 rounded-lg font-semibold">
                        <i class="fas fa-plus mr-2"></i><span id="expense-submit-label">Add Expense</span>
                    </button>
                </form>
            </div>

            <!-- Expenses Table -->
            <div class="glass-card p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Expense Records</h3>
                    <div class="flex flex-col md:flex-row md:items-center md:space-x-2 space-y-2 md:space-y-0">
                        <select id="expense-filter-type" class="glass-input p-2 text-white text-sm">
                            <option value="">All Types</option>
                        </select>
                        <input type="date" id="expense-filter-start-date" class="glass-input p-2 text-white text-sm" placeholder="Start Date">
                        <input type="date" id="expense-filter-end-date" class="glass-input p-2 text-white text-sm" placeholder="End Date">
                        <button onclick="filterExpenseTable()" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-500">Filter</button>   
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left p-3">Type</th>
                                <th class="text-left p-3">Amount</th>
                                <th class="text-left p-3">Date</th>
                                <th class="text-left p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expenses-table-body">
                            <!-- Dynamic content will be inserted here via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Expense Chart -->
            <div class="glass-card p-6">
                <h3 class="text-xl font-semibold mb-4">Expense Breakdown</h3>
                <div class="chart-container">
                    <canvas id="expense-breakdown-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Suspense Cash Dashboard -->
    <div id="suspense-dashboard" class="p-4 pt-24 hidden">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">Suspense Cash Dashboard</h2>
                <button class="back-to-dashboard glass-button px-4 py-2 rounded-lg">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                </button>
            </div>
            
            <!-- Add Suspense Entry Form -->
            <div class="glass-card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">Add New Entry</h3>
                <form id="suspense-form" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="suspense-receiver" placeholder="Receiver Name" class="glass-input p-3 text-white placeholder-gray-300" required>
                    <input type="number" id="suspense-amount" placeholder="Amount" class="glass-input p-3 text-white placeholder-gray-300" required>
                    <input type="date" id="suspense-date" class="glass-input p-3 text-white" required>
                    <input type="number" id="suspense-interest" placeholder="Interest %" step="0.01" class="glass-input p-3 text-white placeholder-gray-300" required>
                    <input type="hidden" id="editing-expense-id">
                    <button type="submit" class="glass-button px-6 py-3 rounded-lg font-semibold md:col-span-4">
                        <i class="fas fa-plus mr-2"></i><span id="form-submit-text">Add Entry</span>
                    </button>
                </form>
            </div>
            
            <!-- Suspense Table -->
            <div class="glass-card p-6">
                <h3 class="text-xl font-semibold mb-4">Suspense Cash Records</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left p-3">Receiver</th>
                                <th class="text-left p-3">Amount</th>
                                <th class="text-left p-3">Date Given</th>
                                <th class="text-left p-3">Interest %</th>
                                <th class="text-left p-3">Current Total</th>
                                <th class="text-left p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="suspense-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- Login Loading Modal -->
    <div id="login-modal" class="modal fixed inset-0 flex items-center justify-center hidden z-50">
        <div class="glass-card p-8 text-center">
            <div class="animate-pulse-slow mb-4">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-400"></i>
            </div>
            <p class="text-lg">Logging in...</p>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let isDarkMode = false;

        // Data Storage Keys
        const STORAGE_KEYS = {
            users: 'syndicate_users',
            currentUser: 'syndicate_current_user',
            income: 'syndicate_income',
            loans: 'syndicate_loans',
            expenses: 'syndicate_expenses',
            suspense: 'syndicate_suspense',
            theme: 'syndicate_theme'
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
            setupEventListeners();
            loadTheme();
        });

        function initializeApp() {
            // Check if user is logged in
            const savedUser = localStorage.getItem(STORAGE_KEYS.currentUser);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            } else {
                showLandingPage();
            }
        }

        function setupEventListeners() {
            // Navigation
            document.getElementById('login-btn').addEventListener('click', showLoginPage);
            document.getElementById('create-account-btn').addEventListener('click', showCreateAccountPage);
            document.getElementById('back-to-landing').addEventListener('click', showLandingPage);
            document.getElementById('back-to-landing-login').addEventListener('click', showLandingPage);
            document.getElementById('logout-btn').addEventListener('click', logout);

            // Dashboard navigation
            document.getElementById('back-to-dashboard').addEventListener('click', showDashboard);
            document.querySelectorAll('.back-to-dashboard').forEach(btn => {
                btn.addEventListener('click', showDashboard);
            });

            // Dashboard cards
            document.querySelectorAll('[data-dashboard]').forEach(card => {
                card.addEventListener('click', function () {
                    const dashboard = this.dataset.dashboard;
                    showSpecificDashboard(dashboard);
                });
            });



            // Forms
            document.getElementById('create-account-form').addEventListener('submit', handleCreateAccount);
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('income-form').addEventListener('submit', handleAddIncome);
            document.getElementById('loan-form').addEventListener('submit', handleAddLoan);
            document.getElementById('expense-form').addEventListener('submit', handleAddExpense);
            document.getElementById('suspense-form').addEventListener('submit', handleAddSuspense);

            // Dynamic fields
            document.getElementById('loan-type').addEventListener('change', updateLoanFields);
            document.getElementById('expense-type').addEventListener('change', handleExpenseTypeChange);

            // Filters
            document.getElementById('income-filter-type').addEventListener('change', filterIncomeTable);
            document.getElementById('income-filter-date').addEventListener('change', filterIncomeTable);
            document.getElementById('expense-filter-type').addEventListener('change', filterExpenseTable);
            document.getElementById('expense-filter-date').addEventListener('change', filterExpenseTable);

            // Theme toggle
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        }

        // Page Navigation Functions
        function showPage(pageId) {
            document.querySelectorAll('[id$="-page"], [id$="-dashboard"]').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');

            if (pageId !== 'landing-page') {
                document.getElementById('navbar').classList.remove('hidden');
            } else {
                document.getElementById('navbar').classList.add('hidden');
            }
        }

        function showLandingPage() {
            showPage('landing-page');
        }

        function showCreateAccountPage() {
            showPage('create-account-page');
        }

        function showLoginPage() {
            showPage('login-page');
        }

        function showDashboard() {
            showPage('dashboard-page');
            updateDashboard();
            updateUsername();
        }

        function showSpecificDashboard(type) {
            const dashboardMap = {
                'income': 'income-dashboard',
                'loans': 'loans-dashboard',
                'expenses': 'expenses-dashboard',
                'suspense': 'suspense-dashboard'
            };

            showPage(dashboardMap[type]);
            updateUsername();

            // Load specific dashboard
            switch (type) {
                case 'income':
                    loadIncomeTable();
                    populateIncomeFilters();
                    break;
                case 'loans':
                    loadLoansTable();
                    break;
                case 'expenses':
                    loadExpensesTable();
                    populateExpenseFilters();
                    updateExpenseChart();
                    break;
                case 'suspense':
                    loadSuspenseTable();
                    break;
            }
        }

       //Authentication functions
        function handleCreateAccount(e) {
            e.preventDefault();

            const name = document.getElementById('ca-name').value;
            const mobile = document.getElementById('ca-mobile').value;
            const username = document.getElementById('ca-username').value;
            const password = document.getElementById('ca-password').value;
            const confirmPassword = document.getElementById('ca-confirm-password').value;

            // Validation
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (!isValidPassword(password)) {
                alert('Password must be alphanumeric and case-sensitive!');
                return;
            }

            // Check if username exists
            const users = getUsers();
            if (users.find(user => user.username === username)) {
                alert('Username already exists!');
                return;
            }
            
            // Create new user
            const newUser = {
                id: Date.now(),
                name,
                mobile,
                username,
                password,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem(STORAGE_KEYS.users, JSON.stringify(users));
            
            // Auto-fill login and show login page
            document.getElementById('login-username').value = username;
            showLoginPage();
            
            // Show success popup
            setTimeout(() => {
                showLoginModal();
                setTimeout(() => {
                    hideLoginModal();
                }, 1000);
            }, 500);
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                showLoginModal();
                setTimeout(() => {
                    currentUser = user;
                    localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(user));
                    hideLoginModal();
                    showDashboard();
                }, 2000);
            } else {
                alert('Invalid username or password!');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem(STORAGE_KEYS.currentUser);
            showLandingPage();
        }

        function isValidPassword(password) {
            // Check for alphanumeric and case-sensitive
            const hasLower = /[a-z]/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasNumber = /\d/.test(password);
            return hasLower && hasUpper && hasNumber && password.length >= 6;
        }

        // Password Eye Toggle Script
        document.addEventListener("DOMContentLoaded", function () {
            function addEyeToggle(inputId) {
                const input = document.getElementById(inputId);
                const wrapper = document.createElement('div');
                wrapper.classList.add('relative');

                input.parentNode.insertBefore(wrapper, input);
                wrapper.appendChild(input);

                const eyeIcon = document.createElement('i');
                eyeIcon.className = 'fas fa-eye absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-300 cursor-pointer';
                wrapper.appendChild(eyeIcon);

                eyeIcon.addEventListener('click', function () {
                    if (input.type === 'password') {
                        input.type = 'text';
                        eyeIcon.classList.replace('fa-eye', 'fa-eye-slash');
                    } else {
                        input.type = 'password';
                        eyeIcon.classList.replace('fa-eye-slash', 'fa-eye');
                    }
                });
            }

            addEyeToggle('ca-password');
            addEyeToggle('ca-confirm-password');
            addEyeToggle('login-password');
        });
        
        // Data Management Functions
        function getUsers() {
            return JSON.parse(localStorage.getItem(STORAGE_KEYS.users) || '[]');
        }

        function getUserData(key) {
            if (!currentUser) return [];
            const data = JSON.parse(localStorage.getItem(key) || '{}');
            return data[currentUser.id] || [];
        }

        function setUserData(key, data) {
            if (!currentUser) return;
            const allData = JSON.parse(localStorage.getItem(key) || '{}');
            allData[currentUser.id] = data;
            localStorage.setItem(key, JSON.stringify(allData));
        }

        // Income Functions
        let editIncomeId = null;

        function handleAddIncome(e) {
            e.preventDefault();

            const type = document.getElementById('income-type').value;
            const amount = parseFloat(document.getElementById('income-amount').value);
            const date = document.getElementById('income-date').value;
            const description = document.getElementById('income-description').value;

            const incomeData = getUserData(STORAGE_KEYS.income);

            if (editIncomeId) {
                const index = incomeData.findIndex(income => income.id === editIncomeId);
                if (index !== -1) {
                    incomeData[index] = {
                        ...incomeData[index],
                        type,
                        amount,
                        date,
                        description
                    };
                }
                editIncomeId = null;
            } else {
                incomeData.push({
                    id: Date.now(),
                    type,
                    amount,
                    date,
                    description,
                    createdAt: new Date().toISOString()
                });
            }

            setUserData(STORAGE_KEYS.income, incomeData);

            // Clear form
            document.getElementById('income-form').reset();
            document.getElementById('income-date').value = new Date().toISOString().split('T')[0];

            // Reload table
            loadIncomeTable();
            populateIncomeFilters();
        }

        function loadIncomeTable() {
            const incomeData = getUserData(STORAGE_KEYS.income);
            const tbody = document.getElementById('income-table-body');

            tbody.innerHTML = incomeData.map(income => `
                <tr class="border-b border-white/10">
                    <td class="p-3">${income.type}</td>
                    <td class="p-3">₹${income.amount.toLocaleString()}</td>
                    <td class="p-3">${formatDate(income.date)}</td>
                    <td class="p-3">${income.description || '-'}</td>
                    <td class="p-3">
                        <button onclick="editIncome(${income.id})" class="text-blue-400 hover:text-blue-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteIncome(${income.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function populateIncomeFilters() {
            const incomeData = getUserData(STORAGE_KEYS.income);
            const typeFilter = document.getElementById('income-filter-type');
            const types = [...new Set(incomeData.map(income => income.type))];

            typeFilter.innerHTML = '<option value="">All Types</option>' + 
                types.map(type => `<option value="${type}">${type}</option>`).join('');
        }

        function filterIncomeTable() {
            const typeFilter = document.getElementById('income-filter-type').value;
            const startDate = document.getElementById('income-filter-start-date').value;
            const endDate = document.getElementById('income-filter-end-date').value;

            const incomeData = getUserData(STORAGE_KEYS.income);

            let filteredData = incomeData;

            if (typeFilter) {
                filteredData = filteredData.filter(income => income.type === typeFilter);
            }

            if (startDate) {
                filteredData = filteredData.filter(income => new Date(income.date) >= new Date(startDate));
            }

            if (endDate) {
                filteredData = filteredData.filter(income => new Date(income.date) <= new Date(endDate));
            }

            const tbody = document.getElementById('income-table-body');
            tbody.innerHTML = filteredData.map(income => `
                <tr class="border-b border-white/10">
                    <td class="p-3">${income.type}</td>
                    <td class="p-3">₹${income.amount.toLocaleString()}</td>
                    <td class="p-3">${formatDate(income.date)}</td>
                    <td class="p-3">${income.description || '-'}</td>
                    <td class="p-3">
                        <button onclick="editIncome(${income.id})" class="text-blue-400 hover:text-blue-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteIncome(${income.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteIncome(id) {
            if (confirm('Are you sure you want to delete this income record?')) {
                const incomeData = getUserData(STORAGE_KEYS.income);
                const updatedData = incomeData.filter(income => income.id !== id);
                setUserData(STORAGE_KEYS.income, updatedData);
                loadIncomeTable();
                populateIncomeFilters();
            }
        }

        function editIncome(id) {
            const incomeData = getUserData(STORAGE_KEYS.income);
            const income = incomeData.find(i => i.id === id);

            if (income) {
                document.getElementById('income-type').value = income.type;
                document.getElementById('income-amount').value = income.amount;
                document.getElementById('income-date').value = income.date;
                document.getElementById('income-description').value = income.description;
                editIncomeId = id;
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Loan Functions
        function updateLoanFields() {
            const loanType = document.getElementById('loan-type').value;
            const fieldsContainer = document.getElementById('loan-fields');
            
            let fieldsHTML = '';
            
            switch(loanType) {
                case 'bank-loan':
                    fieldsHTML = `
                        <input type="text" id="bank-name" placeholder="Bank Name" class="glass-input p-3 text-white placeholder-gray-300" required>
                        <input type="text" id="bank-locality" placeholder="Locality" class="glass-input p-3 text-white placeholder-gray-300" required>
                        <input type="date" id="date-borrowed" class="glass-input p-3 text-white" required>
                        <input type="date" id="renewal-date" class="glass-input p-3 text-white" required>
                        <input type="number" id="gold-grams" placeholder="Grams of Gold" step="0.01" class="glass-input p-3 text-white placeholder-gray-300">
                        <input type="number" id="loan-amount" placeholder="Amount" class="glass-input p-3 text-white placeholder-gray-300" required>
                        <input type="number" id="interest-rate" placeholder="Interest %" step="0.01" class="glass-input p-3 text-white placeholder-gray-300" required>
                    `;
                    break;
                case 'land-loan':
                    fieldsHTML = `
                        <input type="text" id="land-description" placeholder="Land Description" class="glass-input p-3 text-white placeholder-gray-300 md:col-span-2" required>
                        <input type="date" id="date-received" class="glass-input p-3 text-white" required>
                        <input type="number" id="loan-amount" placeholder="Amount" class="glass-input p-3 text-white placeholder-gray-300" required>
                        <input type="number" id="interest-rate" placeholder="Interest %" step="0.01" class="glass-input p-3 text-white placeholder-gray-300" required>
                    `;
                    break;
                case 'debt':
                    fieldsHTML = `
                        <input type="text" id="creditor-name" placeholder="Creditor Name" class="glass-input p-3 text-white placeholder-gray-300" required>
                        <input type="number" id="total-received" placeholder="Total Received" class="glass-input p-3 text-white placeholder-gray-300" required>
                        <input type="number" id="interest-rate" placeholder="Interest %" step="0.01" class="glass-input p-3 text-white placeholder-gray-300" required>
                        <input type="date" id="debt-date" class="glass-input p-3 text-white" required>
                    `;
                    break;
            }
            
            fieldsContainer.innerHTML = fieldsHTML;
        }

        function handleAddLoan(e) {
            e.preventDefault();
            
            const loanType = document.getElementById('loan-type').value;
            let loanData = {
                id: Date.now(),
                type: loanType,
                createdAt: new Date().toISOString()
            };
            
            switch(loanType) {
                case 'bank-loan':
                    loanData = {
                        ...loanData,
                        bankName: document.getElementById('bank-name').value,
                        locality: document.getElementById('bank-locality').value,
                        dateBorrowed: document.getElementById('date-borrowed').value,
                        renewalDate: document.getElementById('renewal-date').value,
                        goldGrams: parseFloat(document.getElementById('gold-grams').value) || 0,
                        amount: parseFloat(document.getElementById('loan-amount').value),
                        interestRate: parseFloat(document.getElementById('interest-rate').value)
                    };
                    break;
                case 'land-loan':
                    loanData = {
                        ...loanData,
                        landDescription: document.getElementById('land-description').value,
                        dateReceived: document.getElementById('date-received').value,
                        amount: parseFloat(document.getElementById('loan-amount').value),
                        interestRate: parseFloat(document.getElementById('interest-rate').value)
                    };
                    break;
                case 'debt':
                    loanData = {
                        ...loanData,
                        creditorName: document.getElementById('creditor-name').value,
                        totalReceived: parseFloat(document.getElementById('total-received').value),
                        interestRate: parseFloat(document.getElementById('interest-rate').value),
                        debtDate: document.getElementById('debt-date').value
                    };
                    break;
            }
            
            const loans = getUserData(STORAGE_KEYS.loans);
            loans.push(loanData);
            setUserData(STORAGE_KEYS.loans, loans);
            
            // Clear form
            document.getElementById('loan-form').reset();
            document.getElementById('loan-fields').innerHTML = '';
            
            loadLoansTable();
        }

        function loadLoansTable() {
            const loans = getUserData(STORAGE_KEYS.loans);
            const tbody = document.getElementById('loans-table-body');
            
            tbody.innerHTML = loans.map(loan => {
                const currentTotal = calculateLoanInterest(loan);
                let details = '';
                
                switch(loan.type) {
                    case 'bank-loan':
                        details = `${loan.bankName} - ${loan.locality}`;
                        break;
                    case 'land-loan':
                        details = loan.landDescription;
                        break;
                    case 'debt':
                        details = loan.creditorName;
                        break;
                }
                
                return `
                    <tr class="border-b border-white/10">
                        <td class="p-3">${formatLoanType(loan.type)}</td>
                        <td class="p-3">${details}</td>
                        <td class="p-3">₹${loan.amount?.toLocaleString() || loan.totalReceived?.toLocaleString()}</td>
                        <td class="p-3">${loan.interestRate}%</td>
                        <td class="p-3">₹${currentTotal.toLocaleString()}</td>
                        <td class="p-3">
                            <button onclick="deleteLoan(${loan.id})" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function calculateLoanInterest(loan) {
            const principal = loan.amount || loan.totalReceived;
            const rate = loan.interestRate / 100;
            const startDate = new Date(loan.dateBorrowed || loan.dateReceived || loan.debtDate);
            const today = new Date();
            const daysDiff = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            const years = daysDiff / 365;
            
            // Simple interest calculation
            return principal * (1 + rate * years);
        }

        function formatLoanType(type) {
            const typeMap = {
                'bank-loan': 'Bank Loan/Gold',
                'land-loan': 'Land Loan',
                'debt': 'Debt'
            };
            return typeMap[type] || type;
        }

        function deleteLoan(id) {
            if (confirm('Are you sure you want to delete this loan record?')) {
                const loans = getUserData(STORAGE_KEYS.loans);
                const updatedData = loans.filter(loan => loan.id !== id);
                setUserData(STORAGE_KEYS.loans, updatedData);
                loadLoansTable();
            }
        }

        // Expense Functions
        function handleExpenseTypeChange() {
            const expenseType = document.getElementById('expense-type').value;
            const customTypeInput = document.getElementById('expense-custom-type');

            if (expenseType === 'Others') {
                customTypeInput.classList.remove('hidden');
                customTypeInput.required = true;
            } else {
                customTypeInput.classList.add('hidden');
                customTypeInput.required = false;
                customTypeInput.value = '';
            }
        }

        let editingExpenseId = null;

        function handleAddExpense(e) {
            e.preventDefault();

            const type = document.getElementById('expense-type').value;
            const customType = document.getElementById('expense-custom-type').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;

            const finalType = type === 'Others' ? customType : type;
            const expenses = getUserData(STORAGE_KEYS.expenses);

            if (editingExpenseId) {
                const index = expenses.findIndex(exp => exp.id === editingExpenseId);
                if (index !== -1) {
                    expenses[index].type = finalType;
                    expenses[index].amount = amount;
                    expenses[index].date = date;
                }
                editingExpenseId = null;
            } else {
                expenses.push({
                    id: Date.now(),
                    type: finalType,
                    amount,
                    date,
                    createdAt: new Date().toISOString()
                });
            }

            setUserData(STORAGE_KEYS.expenses, expenses);

            document.getElementById('expense-form').reset();
            document.getElementById('expense-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('expense-custom-type').classList.add('hidden');

            loadExpensesTable();
            populateExpenseFilters();
            updateExpenseChart();
        }

        function loadExpensesTable() {
            const expenses = getUserData(STORAGE_KEYS.expenses);
            const tbody = document.getElementById('expenses-table-body');

            tbody.innerHTML = expenses.map(expense => `
                <tr class="border-b border-white/10">
                    <td class="p-3">${expense.type}</td>
                    <td class="p-3">₹${expense.amount.toLocaleString()}</td>
                    <td class="p-3">${formatDate(expense.date)}</td>
                    <td class="p-3 flex space-x-2">
                        <button onclick="editExpense(${expense.id})" class="text-green-400 hover:text-green-300">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteExpense(${expense.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function editExpense(id) {
            const expenses = getUserData(STORAGE_KEYS.expenses);
            const expense = expenses.find(exp => exp.id === id);
            if (expense) {
                editingExpenseId = id;
                document.getElementById('expense-type').value = ['Petrol', 'Transport', 'Food', 'Misc'].includes(expense.type) ? expense.type : 'Others';

                if (document.getElementById('expense-type').value === 'Others') {
                    document.getElementById('expense-custom-type').classList.remove('hidden');
                    document.getElementById('expense-custom-type').value = expense.type;
                } else {
                    document.getElementById('expense-custom-type').classList.add('hidden');
                    document.getElementById('expense-custom-type').value = '';
                }

                document.getElementById('expense-amount').value = expense.amount;
                document.getElementById('expense-date').value = expense.date;
            }
        }

        function populateExpenseFilters() {
            const expenses = getUserData(STORAGE_KEYS.expenses);
            const typeFilter = document.getElementById('expense-filter-type');
            const types = [...new Set(expenses.map(expense => expense.type))];

            typeFilter.innerHTML = '<option value="">All Types</option>' +
                types.map(type => `<option value="${type}">${type}</option>`).join('');
        }

        function filterExpenseTable() {
            const typeFilter = document.getElementById('expense-filter-type').value;
            const startDate = document.getElementById('expense-filter-start-date').value;
            const endDate = document.getElementById('expense-filter-end-date').value;

            const expenses = getUserData(STORAGE_KEYS.expenses);
            let filteredData = expenses;

            if (typeFilter) {
                filteredData = filteredData.filter(expense => expense.type === typeFilter);
            }

            if (startDate) {
                filteredData = filteredData.filter(expense => new Date(expense.date) >= new Date(startDate));
            }

            if (endDate) {
                filteredData = filteredData.filter(expense => new Date(expense.date) <= new Date(endDate));
            }

            const tbody = document.getElementById('expenses-table-body');
            tbody.innerHTML = filteredData.map(expense => `
                <tr class="border-b border-white/10">
                    <td class="p-3">${expense.type}</td>
                    <td class="p-3">₹${expense.amount.toLocaleString()}</td>
                    <td class="p-3">${formatDate(expense.date)}</td>
                    <td class="p-3 flex space-x-2">
                        <button onclick="editExpense(${expense.id})" class="text-green-400 hover:text-green-300">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteExpense(${expense.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense record?')) {
                const expenses = getUserData(STORAGE_KEYS.expenses);
                const updatedData = expenses.filter(expense => expense.id !== id);
                setUserData(STORAGE_KEYS.expenses, updatedData);
                loadExpensesTable();
                populateExpenseFilters();
                updateExpenseChart();
            }
        }

        function updateExpenseChart() {
            const expenses = getUserData(STORAGE_KEYS.expenses);
            const expenseByType = {};

            expenses.forEach(expense => {
                expenseByType[expense.type] = (expenseByType[expense.type] || 0) + expense.amount;
            });

            const ctx = document.getElementById('expense-breakdown-chart').getContext('2d');

            if (window.expenseBreakdownChart) {
                window.expenseBreakdownChart.destroy();
            }

            window.expenseBreakdownChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(expenseByType),
                    datasets: [{
                        data: Object.values(expenseByType),
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        // Suspense Cash Functions
        function handleAddSuspense(e) {
            e.preventDefault();

            const receiver = document.getElementById('suspense-receiver').value;
            const amount = parseFloat(document.getElementById('suspense-amount').value);
            const date = document.getElementById('suspense-date').value;
            const interestRate = parseFloat(document.getElementById('suspense-interest').value);
            const editingId = document.getElementById('editing-expense-id').value;

            let suspenseData = getUserData(STORAGE_KEYS.suspense);

            if (editingId) {
                // Update existing entry
                suspenseData = suspenseData.map(entry => {
                    if (entry.id === Number(editingId)) {
                        return {
                            ...entry,
                            receiver,
                            amount,
                            date,
                            interestRate
                        };
                    }
                    return entry;
                });

                document.getElementById('form-submit-text').textContent = 'Add Entry';
            } else {
                // Add new entry
                suspenseData.push({
                    id: Date.now(),
                    receiver,
                    amount,
                    date,
                    interestRate,
                    createdAt: new Date().toISOString()
                });
            }

            setUserData(STORAGE_KEYS.suspense, suspenseData);

            // Reset form
            document.getElementById('suspense-form').reset();
            document.getElementById('suspense-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('editing-expense-id').value = '';

            loadSuspenseTable();
        }

        function loadSuspenseTable() {
            const suspenseData = getUserData(STORAGE_KEYS.suspense);
            const tbody = document.getElementById('suspense-table-body');

            tbody.innerHTML = suspenseData.map(suspense => {
                const currentTotal = calculateSuspenseInterest(suspense);

                return `
                    <tr class="border-b border-white/10">
                        <td class="p-3">${suspense.receiver}</td>
                        <td class="p-3">₹${suspense.amount.toLocaleString()}</td>
                        <td class="p-3">${formatDate(suspense.date)}</td>
                        <td class="p-3">${suspense.interestRate}%</td>
                        <td class="p-3">₹${currentTotal.toLocaleString()}</td>
                        <td class="p-3">
                            <button onclick="editSuspense(${suspense.id})" class="text-yellow-400 hover:text-yellow-300 mr-3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteSuspense(${suspense.id})" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function calculateSuspenseInterest(suspense) {
            const principal = suspense.amount;
            const rate = suspense.interestRate / 100;
            const startDate = new Date(suspense.date);
            const today = new Date();
            const daysDiff = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            const years = daysDiff / 365;

            // Simple interest calculation
            return principal * (1 + rate * years);
        }

        function deleteSuspense(id) {
            if (confirm('Are you sure you want to delete this suspense record?')) {
                const suspenseData = getUserData(STORAGE_KEYS.suspense);
                const updatedData = suspenseData.filter(suspense => suspense.id !== id);
                setUserData(STORAGE_KEYS.suspense, updatedData);
                loadSuspenseTable();
            }
        }

        function editSuspense(id) {
            const suspenseData = getUserData(STORAGE_KEYS.suspense);
            const suspense = suspenseData.find(entry => entry.id === id);

            if (!suspense) return;

            document.getElementById('suspense-receiver').value = suspense.receiver;
            document.getElementById('suspense-amount').value = suspense.amount;
            document.getElementById('suspense-date').value = suspense.date;
            document.getElementById('suspense-interest').value = suspense.interestRate;
            document.getElementById('editing-expense-id').value = suspense.id;
            document.getElementById('form-submit-text').textContent = 'Update Entry';
        }

        
        // Dashboard Functions
        function updateDashboard() {
            updateDashboardTotals();
            updateDashboardCharts();
        }

        function updateDashboardTotals() {
            // Income total
            const income = getUserData(STORAGE_KEYS.income);
            const incomeTotal = income.reduce((sum, item) => sum + item.amount, 0);
            document.getElementById('income-total').textContent = `₹${incomeTotal.toLocaleString()}`;
            
            // Loans total
            const loans = getUserData(STORAGE_KEYS.loans);
            const loansTotal = loans.reduce((sum, loan) => sum + calculateLoanInterest(loan), 0);
            document.getElementById('loans-total').textContent = `₹${loansTotal.toLocaleString()}`;
            
            // Expenses total
            const expenses = getUserData(STORAGE_KEYS.expenses);
            const expensesTotal = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            document.getElementById('expenses-total').textContent = `₹${expensesTotal.toLocaleString()}`;
            
            // Suspense total
            const suspense = getUserData(STORAGE_KEYS.suspense);
            const suspenseTotal = suspense.reduce((sum, item) => sum + calculateSuspenseInterest(item), 0);
            document.getElementById('suspense-total').textContent = `₹${suspenseTotal.toLocaleString()}`;
        }

        function updateDashboardCharts() {
            updateIncomeChart();
            updateDashboardExpenseChart();
        }

        function updateIncomeChart() {
            const income = getUserData(STORAGE_KEYS.income);
            const incomeByType = {};
            
            income.forEach(item => {
                incomeByType[item.type] = (incomeByType[item.type] || 0) + item.amount;
            });
            
            const ctx = document.getElementById('income-chart').getContext('2d');
            
            if (window.incomeChart) {
                window.incomeChart.destroy();
            }
            
            window.incomeChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(incomeByType),
                    datasets: [{
                        data: Object.values(incomeByType),
                        backgroundColor: [
                            '#10B981',
                            '#3B82F6',
                            '#8B5CF6',
                            '#F59E0B',
                            '#EF4444',
                            '#06B6D4',
                            '#84CC16',
                            '#F97316'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        function updateDashboardExpenseChart() {
            const expenses = getUserData(STORAGE_KEYS.expenses);
            const expenseByType = {};
            
            expenses.forEach(expense => {
                expenseByType[expense.type] = (expenseByType[expense.type] || 0) + expense.amount;
            });
            
            const ctx = document.getElementById('expense-chart').getContext('2d');
            
            if (window.dashboardExpenseChart) {
                window.dashboardExpenseChart.destroy();
            }
            
            window.dashboardExpenseChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(expenseByType),
                    datasets: [{
                        data: Object.values(expenseByType),
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        // Utility Functions
        function updateUsername() {
            if (currentUser) {
                document.getElementById('logged-username').textContent = `Welcome, ${currentUser.name}`;
            }
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-IN');
        }

        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        function hideLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
        }

        // Theme Functions
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            
            const themeIcon = document.querySelector('#theme-toggle i');
            themeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            
            localStorage.setItem(STORAGE_KEYS.theme, isDarkMode);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem(STORAGE_KEYS.theme);
            if (savedTheme === 'true') {
                isDarkMode = true;
                document.body.classList.add('dark');
                document.querySelector('#theme-toggle i').className = 'fas fa-sun';
            }
        }

        // Set default dates
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = ['income-date', 'expense-date', 'suspense-date'];
            dateInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = today;
            });
        });
        // tailwind.config.js
        module.exports = {
            theme: {
                extend: {
                    colors: {
                        'frost-blue': '#d0f0ff',
                        'frost-white': '#ffffffcc',
                    },
                    backdropBlur: {
                        'glass': '10px',
                    },
                },
            },
        };
    </script>
</body>
</html>